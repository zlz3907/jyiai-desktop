# 项目需求描述

## 项目名称
AIMetar

## 项目概述
AIMetar 是一个基于 Electron 的桌面应用程序，旨在提供一个集成的浏览体验，支持标签管理、自动更新和自定义布局。

## 功能需求

### 1. 主窗口
- 使用 `BaseWindow` 创建主窗口，支持以下配置：
  - 宽度：1215px
  - 高度：751px
  - 最小宽度：800px
  - 最小高度：600px
  - 深色主题
  - 自动隐藏菜单栏

BaseWindow 分为上下两个部分，上部分是程序的工具栏、标签栏、搜索框、地址栏、返回/前进按钮、刷新、收藏夹、设置按钮等，下部分是浏览器视图。

上部分默认高度为 72px，下部分默认高度为 679px。
下部分是使用 `BrowserView` 创建的视图，支持标签管理。 `TabManager` 负责标签的管理，包括标签的创建、切换、关闭等操作。

### 2. 标签管理
#### 2.1 基础功能
- 实现标签管理器，支持以下操作：
  - 创建新标签
  - 切换标签
  - 关闭标签
  - 导航操作（前进、后退、重新加载、加载指定 URL）

#### 2.2 标签管理弹出菜单
##### 功能概述
实现一个自定义的标签管理弹出菜单，用于展示和管理当前所有打开的标签页。

##### 详细功能
- **基础功能**
  - 显示所有打开的标签列表
  - 标识当前活动标签
  - 支持标签切换
  - 支持标签关闭
  - 支持批量操作（关闭其他、关闭左侧、关闭右侧）
  - 支持新建标签

- **交互设计**
  - 点击触发按钮时在指定位置显示菜单
  - 点击菜单外部区域自动关闭
  - 选择菜单项后自动关闭
  - 支持键盘导航和快捷键
  - 支持鼠标悬停预览
  - 菜单位置自适应（防止超出窗口边界）

- **视觉设计**
  - 遵循应用整体视觉风格
  - 支持亮色/暗色主题
  - 包含图标、标题、URL 等信息
  - 提供视觉反馈（悬停、选中状态）
  - 支持动画过渡效果

##### 技术实现
- **组件结构**
  ```
  src/
    renderer/
      components/
        TabMenu/
          index.js        // 主组件
          MenuItem.js     // 菜单项组件
          MenuGroup.js    // 分组组件
          styles.css      // 样式文件
      hooks/
        useTabMenu.js    // 菜单逻辑钩子
    main/
      windows/
        tabs.js          // 标签管理类
      ipc/
        menu.js          // IPC 通信处理
  ```

- **数据流设计**
  1. 触发显示菜单：Renderer -> IPC -> Main
  2. 获取标签数据：Main -> TabManager
  3. 发送数据到渲染进程：Main -> IPC -> Renderer
  4. 更新菜单状态：Renderer useState
  5. 执行菜单操作：Renderer -> IPC -> Main

##### 性能优化
- 使用虚拟列表处理大量标签
- 优化动画性能
- 减少不必要的渲染
- 实现延迟加载
- 添加状态缓存

##### 安全考虑
- 防止 XSS 注入
- 验证 IPC 消息
- 限制菜单操作权限

### 3. 视图布局
- 创建顶部视图（工具栏和标签栏）和底部视图区域。
- 支持窗口大小调整时，自动更新视图大小。
- 顶部视图默认加载url：http://localhost:59001/desktop

### 4. 自动更新
- 配置自动更新功能，支持检查更新和通知用户。

### 5. IPC 处理
- 设置 IPC 处理程序，支持与渲染进程的通信，包括标签页操作和布局相关操作。

### 6. 菜单
- 创建应用程序菜单，包含以下选项：
  - 应用菜单（关于、退出）
  - 编辑菜单（撤销、重做、剪切、复制、粘贴）
  - 查看菜单（刷新、强制重新加载、开发者工具）

## 技术栈
- **前端**: Electron
- **后端**: Node.js
- **其他**: 使用 `electron-updater` 进行自动更新

## 依赖
- `electron`
- `electron-updater`
- `path`

## 开发环境
- Node.js 版本：14.x 或更高
- Electron 版本：最新稳定版

## 其他信息
- 代码存储在 GitHub 上，使用 GitHub Actions 进行 CI/CD。
- 详细的更新日志记录在 `CHANGELOG.md` 文件中。

# 标签管理弹出菜单实现方案

## 1. 数据结构设计

### 1.1 标签状态数据

# 特殊开发习惯
## JS代码相关说明
- 非必要，尽量不要使用 async/await，尽量使用 Promise